<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>X Benzeri Profesyonel Blog Platformu</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Reset and basics */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: #f5f7fa;
      color: #222;
      overflow: hidden;
      --primary-color: #1da1f2;
      --primary-dark: #0d8ddb;
      --card-bg: #fff;
      --text-primary: #111;
      --text-secondary: #555;
      --shadow-elevation: rgba(0, 0, 0, 0.1);
      --radius: 12px;
    }

    /* Dark mode variables */
    body[data-theme='dark'] {
      background: #121212;
      color: #ddd;
      --card-bg: #1e1e1e;
      --text-primary: #eee;
      --text-secondary: #bbb;
      --shadow-elevation: rgba(0, 0, 0, 0.8);
    }

    /* Layout grid */
    #app {
      display: grid;
      grid-template-rows: 60px 1fr 40px;
      grid-template-columns: 1fr;
      height: 100vh;
      overflow: hidden;
      background: var(--card-bg);
    }

    /* Login and Register Page */
    #loginPage {
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--card-bg);
      height: 100vh;
      padding: 24px;
      user-select: none;
    }

    #loginContainer {
      background: var(--card-bg);
      padding: 32px 48px;
      border-radius: var(--radius);
      box-shadow: 0 0 40px var(--shadow-elevation);
      max-width: 420px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 24px;
      user-select: text;
    }

    #loginContainer h1 {
      font-weight: 700;
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 8px;
      text-align: center;
    }

    /* Forms container */
    .form-section {
      display: none;
      flex-direction: column;
      gap: 16px;
    }
    .form-section.active {
      display: flex;
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    input[type="text"], input[type="password"] {
      padding: 12px 16px;
      border-radius: 8px;
      border: 1.8px solid #cbd5e1;
      font-size: 1rem;
      font-family: inherit;
      background: var(--card-bg);
      color: var(--text-primary);
      outline-offset: 2px;
      transition: border-color 0.25s ease;
    }
    input[type="text"]:focus,
    input[type="password"]:focus {
      border-color: var(--primary-color);
    }
    button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      padding: 14px 0;
      box-shadow: 0 8px 20px rgba(29,161,242,0.3);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background: var(--primary-dark);
    }
    #loginError, #registerError {
      color: #e02424;
      font-weight: 600;
      text-align: center;
      min-height: 24px;
      user-select: none;
    }

    #switchForms {
      text-align: center;
      font-size: 0.9rem;
      color: var(--primary-color);
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      margin-top: 12px;
    }
    #switchForms:hover {
      text-decoration: underline;
    }

    /* Main App Layout */
    #mainPage {
      display: none;
      height: 100%;
      width: 100%;
      display: grid;
      grid-template-columns: 300px 1fr 280px;
      grid-template-rows: 60px 1fr;
      grid-template-areas:
        "sidebar header right"
        "sidebar content right";
      overflow: hidden;
      background: var(--card-bg);
      color: var(--text-primary);
      user-select: none;
    }
    #header {
      grid-area: header;
      position: sticky;
      top: 0;
      background: var(--card-bg);
      z-index: 99;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      border-bottom: 1px solid #cbd5e1;
      box-shadow: 0 2px 4px var(--shadow-elevation);
    }
    #header h2 {
      font-weight: 800;
      color: var(--primary-color);
      font-size: 1.5rem;
      margin: 0;
      display: flex; align-items: center; gap: 8px;
    }
    #header h2 span.material-icons {
      font-size: 2.4rem;
    }
    #header .search-container {
      flex: 1;
      margin: 0 24px;
      max-width: 400px;
      position: relative;
    }
    #header input[type="search"] {
      width: 100%;
      padding: 10px 44px 10px 14px;
      border-radius: 24px;
      border: 1.8px solid #cbd5e1;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      outline-offset: 2px;
      background: var(--card-bg);
      color: var(--text-primary);
    }
    #header input[type="search"]:focus {
      border-color: var(--primary-color);
    }
    #header .search-icon {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 20px;
      pointer-events: none;
    }
    #header .user-menu {
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--primary-color);
    }
    #header .user-menu .material-icons {
      font-size: 28px;
    }
    #header .user-menu span {
      font-weight: 700;
      font-size: 1rem;
    }

    /* Sidebar categories */
    #sidebar {
      grid-area: sidebar;
      border-right: 1.5px solid #cbd5e1;
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      background: var(--card-bg);
      user-select: none;
    }
    #sidebar h3 {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 16px;
      color: var(--primary-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
    }
    #sidebar .category-item {
      font-weight: 600;
      font-size: 1rem;
      padding: 8px 14px;
      margin-bottom: 8px;
      border-radius: 16px;
      color: var(--text-primary);
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    #sidebar .category-item.selected, #sidebar .category-item:hover {
      background: var(--primary-color);
      color: white;
    }
    #sidebar .category-count {
      font-weight: 600;
      font-size: 0.85rem;
      background: var(--primary-color);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      min-width: 24px;
      text-align: center;
      user-select: none;
    }

    /* Right sidebar (Trending & Bookmarks) */
    #rightSidebar {
      grid-area: right;
      border-left: 1.5px solid #cbd5e1;
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      background: var(--card-bg);
    }
    #rightSidebar h3 {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 16px;
      color: var(--primary-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
    }
    #rightSidebar .trending-item, #rightSidebar .bookmark-item {
      font-weight: 600;
      font-size: 0.95rem;
      padding: 8px 14px;
      margin-bottom: 8px;
      border-radius: 16px;
      background: #e1e8f7;
      cursor: default;
      user-select: none;
      color: var(--text-primary);
      transition: background-color 0.3s ease;
    }
    body[data-theme='dark'] #rightSidebar .trending-item, 
    body[data-theme='dark'] #rightSidebar .bookmark-item {
      background: #2c2c2c;
      color: var(--text-primary);
    }

    /* Content area with article feed */
    #content {
      grid-area: content;
      overflow-y: auto;
      padding: 24px;
      background: var(--card-bg);
      display: flex;
      flex-direction: column;
      gap: 24px;
      height: 100%;
    }

    /* Article card */
    .article-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 8px 24px var(--shadow-elevation);
      display: flex;
      flex-direction: column;
      user-select: text;
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    .article-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 40px var(--shadow-elevation);
    }
    .article-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      filter: brightness(1);
      transition: filter 0.3s ease;
      user-select: none;
    }
    .article-card:hover .article-image {
      filter: brightness(0.85);
    }
    .article-content {
      padding: 20px;
    }
    .article-title {
      font-weight: 800;
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--primary-color);
      cursor: pointer;
      user-select: text;
    }
    .article-summary {
      font-weight: 500;
      font-size: 1rem;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: 16px;
      user-select: text;
    }
    .article-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 12px;
    }
    .article-meta span {
      display: flex;
      align-items: center;
      gap: 6px;
      user-select: none;
    }
    .article-meta .material-icons {
      font-size: 18px;
      color: var(--primary-color);
    }

    /* Article actions */
    .article-actions {
      display: flex;
      gap: 16px;
      justify-content: flex-end;
    }
    .action-button {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      border: none;
      background: transparent;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--primary-color);
      padding: 6px 12px;
      border-radius: 12px;
      transition: background-color 0.25s ease;
      user-select: none;
    }
    .action-button:hover {
      background-color: var(--primary-color);
      color: white;
    }
    .action-button .material-icons {
      font-size: 20px;
    }

    /* Scrollbar styling */
    #content::-webkit-scrollbar,
    #sidebar::-webkit-scrollbar,
    #rightSidebar::-webkit-scrollbar {
      width: 8px;
    }
    #content::-webkit-scrollbar-thumb,
    #sidebar::-webkit-scrollbar-thumb,
    #rightSidebar::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 10px;
    }
    #content::-webkit-scrollbar-track,
    #sidebar::-webkit-scrollbar-track,
    #rightSidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    /* New/Edit Article Modal */
    #modalOverlay {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.45);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 150;
      padding: 24px;
    }
    #modalOverlay.show {
      display: flex;
    }
    #articleModal {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 0 60px var(--shadow-elevation);
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      user-select: text;
    }
    #articleModal h3 {
      margin-top: 0;
      font-weight: 800;
      font-size: 1.7rem;
      color: var(--primary-color);
      user-select: text;
    }
    #articleModal label {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 6px;
      color: var(--text-primary);
      user-select: text;
    }
    #articleModal input[type="text"], #articleModal textarea, #articleModal select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1.5px solid #cbd5e1;
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      outline-offset: 2px;
      background: var(--card-bg);
      color: var(--text-primary);
      transition: border-color 0.3s ease;
    }
    #articleModal input[type="text"]:focus,
    #articleModal textarea:focus,
    #articleModal select:focus {
      border-color: var(--primary-color);
    }
    #articleModal textarea {
      min-height: 140px;
      line-height: 1.5;
    }
    #articleModal .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
      margin-top: 12px;
    }
    #articleModal button {
      cursor: pointer;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 12px;
      border: none;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #articleModal .btn-cancel {
      background: #ccc;
      color: #444;
    }
    #articleModal .btn-cancel:hover {
      background: #b0b0b0;
    }
    #articleModal .btn-save {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 8px 20px rgba(29,161,242,0.3);
    }
    #articleModal .btn-save:hover {
      background: var(--primary-dark);
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      #mainPage {
        grid-template-columns: 240px 1fr 220px;
      }
      #sidebar {
        padding: 16px 8px;
      }
      #rightSidebar {
        padding: 16px 8px;
      }
      #header .search-container {
        max-width: 300px;
        margin: 0 12px;
      }
    }
    @media (max-width: 768px) {
      #mainPage {
        grid-template-columns: 1fr;
        grid-template-rows: 60px 1fr 280px;
        grid-template-areas:
          "header"
          "content"
          "right";
      }
      #sidebar {
        display: none;
      }
      #rightSidebar {
        border-left: none;
        border-top: 1.5px solid #cbd5e1;
      }
      #header .search-container {
        max-width: 100%;
        margin: 0 8px;
      }
    }
    @media (max-width: 480px) {
      #header h2 {
        font-size: 1.25rem;
      }
      #header h2 span.material-icons {
        font-size: 1.8rem;
      }
      #header .user-menu span {
        display: none;
      }
    }

  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <section id="loginPage" aria-label="Kullanıcı Girişi Ekranı">
    <div id="loginContainer">
      <h1><span class="material-icons" aria-hidden="true">chat</span> X Benzeri Blog</h1>

      <!-- Login Form -->
      <form id="loginForm" aria-describedby="loginError" novalidate class="form-section active" aria-label="Giriş Formu">
        <label for="username">Kullanıcı Adı</label>
        <input type="text" id="username" name="username" placeholder="Kullanıcı adınızı girin" autocomplete="username" required aria-required="true" />
        <label for="password">Şifre</label>
        <input type="password" id="password" name="password" placeholder="Şifrenizi girin" autocomplete="current-password" required aria-required="true" />
        <button type="submit" aria-label="Giriş yap">Giriş Yap</button>
        <div id="loginError" role="alert" aria-live="assertive"></div>
        <div id="switchToRegister" tabindex="0" role="button" aria-label="Kayıt ol sayfasına geç" >
          <span id="switchForms" >Kayıt Olmak İster misiniz?</span>
        </div>
      </form>

      <!-- Register Form -->
      <form id="registerForm" aria-describedby="registerError" novalidate class="form-section" aria-label="Kayıt Formu">
        <label for="regUsername">Kullanıcı Adı</label>
        <input type="text" id="regUsername" name="regUsername" placeholder="Kullanıcı adı seçin" autocomplete="username" required aria-required="true" />
        <label for="regName">Adınız</label>
        <input type="text" id="regName" name="regName" placeholder="Adınızı girin" autocomplete="name" required aria-required="true" />
        <label for="regPassword">Şifre</label>
        <input type="password" id="regPassword" name="regPassword" placeholder="Şifre oluşturun" autocomplete="new-password" required aria-required="true" />
        <label for="regPasswordConfirm">Şifre (Tekrar)</label>
        <input type="password" id="regPasswordConfirm" name="regPasswordConfirm" placeholder="Şifrenizi tekrar girin" autocomplete="new-password" required aria-required="true" />
        <button type="submit" aria-label="Kayıt ol">Kayıt Ol</button>
        <div id="registerError" role="alert" aria-live="assertive"></div>
        <div id="switchToLogin" tabindex="0" role="button" aria-label="Giriş sayfasına geç" >
          <span id="switchForms" >Zaten hesabınız var mı? Giriş Yapın</span>
        </div>
      </form>
    </div>
  </section>

  <!-- MAIN APP -->
  <section id="mainPage" aria-label="Ana İçerik Alanı" tabindex="-1">
    <header id="header" role="banner">
      <h2><span class="material-icons" aria-hidden="true">chat</span> X Blog</h2>
      <div class="search-container">
        <input type="search" id="searchInput" placeholder="İçeriklerde ara..." aria-label="İçeriklerde ara" />
        <span class="material-icons search-icon" aria-hidden="true">search</span>
      </div>
      <button id="newArticleBtn" class="action-button" aria-label="Yeni makale oluştur">
        <span class="material-icons" aria-hidden="true">add_circle_outline</span> Yeni Yazı
      </button>
      <div class="user-menu" id="userMenuBtn" aria-haspopup="true" aria-expanded="false" tabindex="0" role="button" aria-label="Kullanıcı menüsü">
        <span class="material-icons" aria-hidden="true">account_circle</span>
        <span id="userNameDisplay"></span>
        <span class="material-icons" aria-hidden="true" style="font-size: 20px;">expand_more</span>
      </div>
      <div id="userMenuDropdown" role="menu" aria-label="Kullanıcı menüsü" tabindex="-1">
        <button id="logoutBtn" role="menuitem" tabindex="0"><span class="material-icons" aria-hidden="true">logout</span> Çıkış Yap</button>
        <button id="toggleThemeBtn" role="menuitem" tabindex="0"><span class="material-icons" aria-hidden="true">dark_mode</span> Tema Değiştir</button>
      </div>
    </header>

    <aside id="sidebar" role="complementary" aria-label="Kategori Menüsü">
      <h3>Kategoriler</h3>
      <div id="categoryList" role="list" aria-label="Kategori listesi"></div>
    </aside>

    <main id="content" tabindex="0" role="main" aria-live="polite" aria-relevant="additions removals">
      <!-- Article cards will be inserted here dynamically -->
    </main>

    <aside id="rightSidebar" role="complementary" aria-label="Trendler ve Yer İşaretleri">
      <h3>Popüler Konular</h3>
      <div id="trendingList"></div>
      <h3>Yer İşaretleri</h3>
      <div id="bookmarkList"></div>
    </aside>
  </section>

  <!-- Article Modal for New/Edit -->
  <div id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
    <section id="articleModal">
      <h3 id="modalTitle">Yeni Makale</h3>
      <form id="articleForm" novalidate>
        <label for="articleTitle">Başlık</label>
        <input type="text" id="articleTitle" name="title" placeholder="Makale başlığı" required aria-required="true" />
        <label for="articleContent">İçerik</label>
        <textarea id="articleContent" name="content" placeholder="Makalenizi buraya yazın..." required aria-required="true"></textarea>
        <label for="articleImage">Resim URL (isteğe bağlı)</label>
        <input type="text" id="articleImage" name="imageUrl" placeholder="https://..." />
        <label for="articleCategory">Kategori</label>
        <select id="articleCategory" name="category" required aria-required="true"></select>
        <label for="articleTags">Etiketler (virgülle ayır)</label>
        <input type="text" id="articleTags" name="tags" placeholder="örnek: teknoloji, yazılım" />
        <div class="modal-buttons">
          <button type="button" class="btn-cancel" id="modalCancelBtn">İptal</button>
          <button type="submit" class="btn-save" id="modalSaveBtn">Kaydet</button>
        </div>
      </form>
    </section>
  </div>

  <script>
    (() => {
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        if (isNaN(date)) return "";
        return date.toLocaleDateString('tr-TR');
      }
      function generateId() {
        return '_' + Math.random().toString(36).substr(2, 9);
      }
      function loadData(key, defaultValue) {
        try {
          const item = localStorage.getItem(key);
          if (item) return JSON.parse(item);
          else return defaultValue;
        } catch {
          return defaultValue;
        }
      }
      function saveData(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
      }
      function escapeHTML(str) {
        if (!str) return "";
        return str.replace(/[&<>'"]/g, tag => ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          "'": '&#39;',
          '"': '&quot;'
        })[tag] || tag);
      }

      let currentUser = null;
      let articles = [];
      let users = [];
      let categories = [
        { id: 'all', name: 'Tümü', color: '#1da1f2' },
        { id: 'teknoloji', name: 'Teknoloji', color: '#ff5722' },
        { id: 'gundem', name: 'Gündem', color: '#673ab7' },
        { id: 'spor', name: 'Spor', color: '#009688' },
        { id: 'egitim', name: 'Eğitim', color: '#e91e63' },
        { id: 'sanat', name: 'Sanat', color: '#795548' },
      ];
      let filteredCategories = ['all'];
      let bookmarks = [];
      let theme = 'light';
      let searchQuery = '';
      let dummyUsers = [
        { username: 'admin', password: '123456', name: 'Admin Kullanıcı' },
        { username: 'kullanici', password: 'password', name: 'Test Kullanıcı' },
      ];

      const loginPage = document.getElementById('loginPage');
      const loginContainer = document.getElementById('loginContainer');
      const loginForm = document.getElementById('loginForm');
      const loginError = document.getElementById('loginError');
      const registerForm = document.getElementById('registerForm');
      const registerError = document.getElementById('registerError');
      const mainPage = document.getElementById('mainPage');
      const userNameDisplay = document.getElementById('userNameDisplay');
      const contentEl = document.getElementById('content');
      const categoryListEl = document.getElementById('categoryList');
      const trendingListEl = document.getElementById('trendingList');
      const bookmarkListEl = document.getElementById('bookmarkList');
      const searchInput = document.getElementById('searchInput');
      const newArticleBtn = document.getElementById('newArticleBtn');
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userMenuDropdown = document.getElementById('userMenuDropdown');
      const logoutBtn = document.getElementById('logoutBtn');
      const toggleThemeBtn = document.getElementById('toggleThemeBtn');
      const modalOverlay = document.getElementById('modalOverlay');
      const articleModal = document.getElementById('articleModal');
      const modalTitle = document.getElementById('modalTitle');
      const articleForm = document.getElementById('articleForm');
      const articleTitleInput = document.getElementById('articleTitle');
      const articleContentInput = document.getElementById('articleContent');
      const articleImageInput = document.getElementById('articleImage');
      const articleCategorySelect = document.getElementById('articleCategory');
      const articleTagsInput = document.getElementById('articleTags');
      const modalCancelBtn = document.getElementById('modalCancelBtn');
      const modalSaveBtn = document.getElementById('modalSaveBtn');
      const switchToRegisterBtn = document.getElementById('switchToRegister');
      const switchToLoginBtn = document.getElementById('switchToLogin');

      let editingArticleId = null;

      function loadAppData() {
        articles = loadData('articles', []);
        bookmarks = loadData('bookmarks', []);
        users = loadData('users', dummyUsers);
        theme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', theme);
      }
      function persistAppData() {
        saveData('articles', articles);
        saveData('bookmarks', bookmarks);
        saveData('users', users);
      }
      function authenticateUser(username, password) {
        const user = users.find(
          (u) => u.username === username && u.password === password
        );
        return user || null;
      }

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loginError.textContent = '';
        const username = loginForm.username.value.trim();
        const password = loginForm.password.value;
        if (!username || !password) {
          loginError.textContent = 'Lütfen kullanıcı adı ve şifrenizi girin.';
          return;
        }
        const user = authenticateUser(username, password);
        if (user) {
          currentUser = user;
          userNameDisplay.textContent = currentUser.name;
          showMainPage();
        } else {
          loginError.textContent = 'Geçersiz kullanıcı adı veya şifre.';
        }
      });

      registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        registerError.textContent = '';
        const regUsername = registerForm.regUsername.value.trim();
        const regName = registerForm.regName.value.trim();
        const regPassword = registerForm.regPassword.value;
        const regPasswordConfirm = registerForm.regPasswordConfirm.value;
        if (!regUsername || !regName || !regPassword || !regPasswordConfirm) {
          registerError.textContent = 'Lütfen tüm alanları doldurun.';
          return;
        }
        if (regPassword !== regPasswordConfirm) {
          registerError.textContent = 'Şifreler uyuşmuyor.';
          return;
        }
        if (users.some(u => u.username.toLowerCase() === regUsername.toLowerCase())) {
          registerError.textContent = 'Bu kullanıcı adı zaten alınmış.';
          return;
        }
        const newUser = { username: regUsername, name: regName, password: regPassword };
        users.push(newUser);
        persistAppData();
        currentUser = newUser;
        userNameDisplay.textContent = currentUser.name;
        showMainPage();
      });

      switchToRegisterBtn.addEventListener('click', () => {
        loginForm.classList.remove('active');
        registerForm.classList.add('active');
        loginError.textContent = '';
        registerError.textContent = '';
      });
      switchToRegisterBtn.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          switchToRegisterBtn.click();
        }
      });

      switchToLoginBtn.addEventListener('click', () => {
        registerForm.classList.remove('active');
        loginForm.classList.add('active');
        loginError.textContent = '';
        registerError.textContent = '';
      });
      switchToLoginBtn.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          switchToLoginBtn.click();
        }
      });

      function showMainPage() {
        loginPage.style.display = 'none';
        mainPage.style.display = 'grid';
        searchInput.focus();
        renderCategories();
        renderArticles();
        renderTrending();
        renderBookmarks();
      }

      function logout() {
        currentUser = null;
        loginForm.reset();
        registerForm.reset();
        loginError.textContent = '';
        registerError.textContent = '';
        registerForm.classList.remove('active');
        loginForm.classList.add('active');
        mainPage.style.display = 'none';
        loginPage.style.display = 'flex';
      }

      function renderCategories() {
        categoryListEl.innerHTML = '';
        categories.forEach(cat => {
          const isSelected = filteredCategories.includes(cat.id);
          const catEl = document.createElement('div');
          catEl.className = 'category-item' + (isSelected ? ' selected' : '');
          catEl.setAttribute('role', 'listitem');
          catEl.setAttribute('tabindex', '0');
          catEl.style.borderLeft = `6px solid ${cat.color}`;
          catEl.textContent = cat.name;
          const count = articles.filter(a => a.category === cat.id || cat.id === 'all').length;
          const countEl = document.createElement('div');
          countEl.className = 'category-count';
          countEl.textContent = count;
          catEl.appendChild(countEl);
          catEl.addEventListener('click', () => {
            toggleCategoryFilter(cat.id);
          });
          catEl.addEventListener('keydown', e => {
            if(e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              toggleCategoryFilter(cat.id);
            }
          });
          categoryListEl.appendChild(catEl);
        });
      }

      function toggleCategoryFilter(catId) {
        if (catId === 'all') {
          filteredCategories = ['all'];
        } else {
          filteredCategories = filteredCategories.filter(c => c !== 'all');
          if (filteredCategories.includes(catId)) {
            filteredCategories = filteredCategories.filter(c => c !== catId);
          } else {
            filteredCategories.push(catId);
          }
          if (filteredCategories.length === 0) filteredCategories = ['all'];
        }
        renderCategories();
        renderArticles();
      }

      function renderArticles() {
        contentEl.innerHTML = '';
        let filteredArticles = articles;
        if (!filteredCategories.includes('all')) {
          filteredArticles = filteredArticles.filter(article => filteredCategories.includes(article.category));
        }
        if (searchQuery.trim().length > 0) {
          const q = searchQuery.toLowerCase();
          filteredArticles = filteredArticles.filter(a =>
            a.title.toLowerCase().includes(q) ||
            a.content.toLowerCase().includes(q) ||
            (a.tags && a.tags.some(tag => tag.toLowerCase().includes(q)))
          );
        }
        filteredArticles.sort((a,b) => new Date(b.publishedAt) - new Date(a.publishedAt));
        if (filteredArticles.length === 0) {
          contentEl.innerHTML = '<p style="font-weight:600; text-align:center; margin-top:40px; color: var(--text-secondary);">Gösterilecek makale yok.</p>';
          return;
        }
        filteredArticles.forEach(article => {
          const card = createArticleCard(article);
          contentEl.appendChild(card);
        });
      }

      function createArticleCard(article) {
        const card = document.createElement('article');
        card.className = 'article-card';
        card.setAttribute('tabindex', '0');
        card.setAttribute('aria-label', 'Makale: ' + article.title);
        const imgSrc = article.imageUrl || `https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/55ef4081-e3b2-4780-9c21-4576cce88a0c.png => c.id === article.category)?.color?.replace('#','') || '0891b2'}/ffffff?text=Resim+Yok`;
        const imgAlt = article.title + ' başlıklı makale resmi';
        card.innerHTML = `
          <img src="${escapeHTML(imgSrc)}" alt="${escapeHTML(imgAlt)}" class="article-image" loading="lazy" />
          <div class="article-content">
            <h3 class="article-title" tabindex="0">${escapeHTML(article.title)}</h3>
            <p class="article-summary">${escapeHTML(article.content.length > 200 ? article.content.slice(0, 200) + '...' : article.content)}</p>
            <div class="article-meta">
              <span title="Yayın tarihi"><span class="material-icons" aria-hidden="true">event</span>${formatDate(article.publishedAt)}</span>
              <span title="Kategori" style="color: ${categories.find(c => c.id === article.category)?.color || 'inherit'};">
                <span class="material-icons" aria-hidden="true">folder</span>${categories.find(c => c.id === article.category)?.name || 'Bilinmeyen'}
              </span>
            </div>
            <div class="article-actions" role="toolbar" aria-label="Makale işlemleri">
              <button class="action-button edit-btn" aria-label="Makale düzenle" title="Düzenle" data-id="${article.id}">
                <span class="material-icons" aria-hidden="true">edit</span>Düzenle
              </button>
              <button class="action-button delete-btn" aria-label="Makale sil" title="Sil" data-id="${article.id}">
                <span class="material-icons" aria-hidden="true">delete</span>Sil
              </button>
              <button class="action-button bookmark-btn" aria-label="Yer işaretine ekle" title="Yer işaretine ekle" data-id="${article.id}">
                <span class="material-icons" aria-hidden="true">${bookmarks.includes(article.id) ? 'bookmark' : 'bookmark_border'}</span>${bookmarks.includes(article.id) ? 'Yer İşaretinden Çıkar' : 'Yer İşaretine Ekle'}
              </button>
            </div>
          </div>
        `;
        card.querySelector('.edit-btn').addEventListener('click', () => openEditModal(article.id));
        card.querySelector('.delete-btn').addEventListener('click', () => deleteArticle(article.id));
        card.querySelector('.bookmark-btn').addEventListener('click', () => toggleBookmark(article.id));
        return card;
      }

      function renderBookmarks() {
        bookmarkListEl.innerHTML = '';
        if (bookmarks.length === 0) {
          bookmarkListEl.innerHTML = '<p style="text-align:center; color: var(--text-secondary); font-style: italic;">İşaretlenmiş makale yok.</p>';
          return;
        }
        bookmarks.forEach(id => {
          const article = articles.find(a => a.id === id);
          if (!article) return;
          const item = document.createElement('div');
          item.className = 'bookmark-item';
          item.textContent = article.title;
          bookmarkListEl.appendChild(item);
        });
      }
      function toggleBookmark(articleId) {
        if (bookmarks.includes(articleId)) {
          bookmarks = bookmarks.filter(id => id !== articleId);
        } else {
          bookmarks.push(articleId);
        }
        persistAppData();
        renderArticles();
        renderBookmarks();
      }
      function renderTrending() {
        trendingListEl.innerHTML = '';
        const trendings = articles.slice().sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0,5);
        if (trendings.length === 0) {
          trendingListEl.innerHTML = '<p style="text-align:center; color: var(--text-secondary); font-style: italic;">Trend bilgi yok.</p>';
          return;
        }
        trendings.forEach(article => {
          const div = document.createElement('div');
          div.className = 'trending-item';
          div.textContent = article.title;
          trendingListEl.appendChild(div);
        });
      }
      searchInput.addEventListener('input', (e) => {
        searchQuery = e.target.value;
        renderArticles();
      });
      userMenuBtn.addEventListener('click', () => {
        const expanded = userMenuBtn.getAttribute('aria-expanded') === 'true';
        if (!expanded) openUserMenu();
        else closeUserMenu();
      });
      userMenuBtn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const expanded = userMenuBtn.getAttribute('aria-expanded') === 'true';
          if (!expanded) openUserMenu();
          else closeUserMenu();
        }
      });
      function openUserMenu() {
        userMenuDropdown.style.display = 'flex';
        userMenuDropdown.setAttribute('tabindex', '0');
        userMenuBtn.setAttribute('aria-expanded', 'true');
        userMenuDropdown.focus();
      }
      function closeUserMenu() {
        userMenuDropdown.style.display = 'none';
        userMenuBtn.setAttribute('aria-expanded', 'false');
      }
      document.addEventListener('click', (e) => {
        if (!userMenuBtn.contains(e.target) && !userMenuDropdown.contains(e.target)) {
          closeUserMenu();
        }
      });
      logoutBtn.addEventListener('click', () => {
        logout();
      });
      toggleThemeBtn.addEventListener('click', () => {
        theme = theme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        closeUserMenu();
      });
      newArticleBtn.addEventListener('click', () => {
        openNewModal();
      });
      modalCancelBtn.addEventListener('click', () => {
        closeModal();
      });
      modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
          closeModal();
        }
      });
      articleForm.addEventListener('submit', (e) => {
        e.preventDefault();
        saveArticle();
      });
      function openNewModal() {
        editingArticleId = null;
        modalTitle.textContent = 'Yeni Makale Oluştur';
        articleForm.reset();
        populateCategorySelect();
        modalOverlay.classList.add('show');
        articleTitleInput.focus();
      }
      function openEditModal(articleId) {
        const article = articles.find(a => a.id === articleId);
        if (!article) return;
        editingArticleId = articleId;
        modalTitle.textContent = 'Makale Düzenle';
        articleTitleInput.value = article.title;
        articleContentInput.value = article.content;
        articleImageInput.value = article.imageUrl || '';
        populateCategorySelect(article.category);
        articleTagsInput.value = (article.tags && article.tags.join(',')) || '';
        modalOverlay.classList.add('show');
        articleTitleInput.focus();
      }
      function closeModal() {
        modalOverlay.classList.remove('show');
        editingArticleId = null;
      }
      function populateCategorySelect(selected = null) {
        articleCategorySelect.innerHTML = '';
        categories.forEach(cat => {
          if (cat.id === 'all') return;
          const option = document.createElement('option');
          option.value = cat.id;
          option.textContent = cat.name;
          if (cat.id === selected) option.selected = true;
          articleCategorySelect.appendChild(option);
        });
      }
      function saveArticle() {
        const title = articleTitleInput.value.trim();
        const content = articleContentInput.value.trim();
        const imageUrl = articleImageInput.value.trim();
        const category = articleCategorySelect.value;
        const tagsRaw = articleTagsInput.value.trim();
        const tags = tagsRaw ? tagsRaw.split(',').map(t => t.trim()).filter(t => t.length > 0) : [];
        if (!title || !content || !category) {
          alert('Başlık, içerik ve kategori alanları zorunludur.');
          return;
        }
        if (editingArticleId) {
          let article = articles.find(a => a.id === editingArticleId);
          if (article) {
            article.title = title;
            article.content = content;
            article.imageUrl = imageUrl;
            article.category = category;
            article.tags = tags;
          }
        } else {
          const newArticle = {
            id: generateId(),
            title,
            content,
            imageUrl,
            category,
            tags,
            publishedAt: new Date().toISOString(),
            views: 0,
          };
          articles.push(newArticle);
        }
        persistAppData();
        renderArticles();
        renderBookmarks();
        renderTrending();
        closeModal();
      }
      function deleteArticle(articleId) {
        if (!confirm('Bu makaleyi silmek istediğinizden emin misiniz?')) return;
        articles = articles.filter(a => a.id !== articleId);
        bookmarks = bookmarks.filter(id => id !== articleId);
        persistAppData();
        renderArticles();
        renderBookmarks();
        renderTrending();
      }
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (modalOverlay.classList.contains('show')) {
            closeModal();
          }
          if (userMenuDropdown.style.display === 'flex') {
            closeUserMenu();
          }
        }
      });
      loadAppData();
      loginPage.style.display = 'flex';
      mainPage.style.display = 'none';
    })();
  </script>
</body>
</html>

